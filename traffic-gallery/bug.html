<!--
=================================================================================
äº¤é€šå›¾åº“ - BUGæäº¤é¡µé¢ (bug.html)
=================================================================================

ã€æ–‡ä»¶è¯´æ˜ã€‘
æœ¬æ–‡ä»¶æ˜¯äº¤é€šå›¾åº“ç½‘ç«™çš„BUGæäº¤é¡µé¢ï¼Œä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š

1. BUGæäº¤è¡¨å•ï¼šç”¨æˆ·å¯ä»¥æäº¤å‘ç°çš„ç½‘ç«™é—®é¢˜
2. è¡¨å•éªŒè¯ï¼šå®æ—¶éªŒè¯ç”¨æˆ·è¾“å…¥çš„å†…å®¹
3. æˆªå›¾ä¸Šä¼ ï¼šæ”¯æŒæ‹–æ‹½å’Œç‚¹å‡»ä¸Šä¼ BUGæˆªå›¾
4. ä¼˜å…ˆçº§é€‰æ‹©ï¼šç”¨æˆ·å¯ä»¥è®¾ç½®BUGçš„ç´§æ€¥ç¨‹åº¦
5. è‡ªåŠ¨ä¿¡æ¯é‡‡é›†ï¼šè‡ªåŠ¨è·å–æµè§ˆå™¨ä¿¡æ¯
6. å®æ—¶åé¦ˆï¼šæäº¤è¿‡ç¨‹ä¸­çš„çŠ¶æ€æç¤º
7. æ•°æ®å¤„ç†ï¼šå°†BUGæ•°æ®æäº¤åˆ°bug.jsè¿›è¡Œå¤„ç†

ã€æŠ€æœ¯ç‰¹ç‚¹ã€‘
- å“åº”å¼è®¾è®¡ï¼šé€‚é…ä¸åŒå±å¹•å°ºå¯¸
- å®æ—¶è¡¨å•éªŒè¯ï¼šæä¾›å³æ—¶çš„è¾“å…¥åé¦ˆ
- æ‹–æ‹½ä¸Šä¼ ï¼šæ”¯æŒæ–‡ä»¶æ‹–æ‹½ä¸Šä¼ åŠŸèƒ½
- å›¾ç‰‡é¢„è§ˆï¼šä¸Šä¼ æˆªå›¾åå®æ—¶é¢„è§ˆ
- å­—ç¬¦è®¡æ•°ï¼šæ ‡é¢˜å’Œæè¿°çš„å­—æ•°é™åˆ¶æç¤º
- ä¼˜å…ˆçº§å¯è§†åŒ–ï¼šé€šè¿‡é¢œè‰²å’Œå›¾æ ‡ç›´è§‚æ˜¾ç¤ºä¼˜å…ˆçº§
- æ¶ˆæ¯æç¤ºï¼šæäº¤ç»“æœçš„åŠ¨ç”»æ¶ˆæ¯æç¤º
--><!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æäº¤BUG - äº¤é€šå›¾åº“</title>
  <meta name="description" content="äº¤é€šå›¾åº“æäº¤BUGé¡µé¢ï¼Œç”¨æˆ·å¯ä»¥åœ¨æ­¤æäº¤å‘ç°çš„BUGï¼Œç®¡ç†å‘˜ä¼šå¯¹å…¶è¿›è¡Œå¤„ç†ã€‚">
  <!-- å…¨å±€æ ·å¼ -->
  <link rel="stylesheet" href="css/global.css">
  <link rel="stylesheet" href="css/layout.css">
  <!-- æ ¸å¿ƒJSæ–‡ä»¶ -->
  <script src="js/config.js"></script>
  <script src="js/database.js"></script>
  <script src="js/bug.js"></script>
  <script src="js/bug-sync.js"></script>
  <script src="js/main.js"></script>
  <style>
    /* BUGæäº¤é¡µé¢ç‰¹æœ‰æ ·å¼ */
    .bug-section {
      padding: 2rem 0;
    }
    
    .bug-form-container {
      max-width: 800px;
      margin: 0 auto;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 2rem;
    }
    
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-label {
      display: block;
      font-weight: 600;
      color: #333;
      margin-bottom: 0.5rem;
    }
    
    .form-label .required {
      color: #e74c3c;
      margin-left: 0.25rem;
    }
    
    .form-control {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 1rem;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    
    .form-control:focus {
      outline: none;
      border-color: #3498db;
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }
    
    .form-control.error {
      border-color: #e74c3c;
    }
    
    textarea.form-control {
      resize: vertical;
      min-height: 120px;
    }
    
    .form-hint {
      font-size: 0.875rem;
      color: #7f8c8d;
      margin-top: 0.25rem;
    }
    
    .char-count {
      font-size: 0.875rem;
      color: #7f8c8d;
      text-align: right;
      margin-top: 0.25rem;
    }
    
    .char-count.warning {
      color: #f39c12;
    }
    
    .char-count.error {
      color: #e74c3c;
    }
    
    .priority-options {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }
    
    .priority-option {
      flex: 1;
      min-width: 120px;
    }
    
    .priority-option input[type="radio"] {
      display: none;
    }
    
    .priority-option label {
      display: block;
      padding: 0.75rem 1rem;
      border: 2px solid #ddd;
      border-radius: 4px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .priority-option input[type="radio"]:checked + label {
      border-color: #3498db;
      background-color: rgba(52, 152, 219, 0.1);
    }
    
    .priority-option.low input[type="radio"]:checked + label {
      border-color: #28a745;
      background-color: rgba(40, 167, 69, 0.1);
    }
    
    .priority-option.medium input[type="radio"]:checked + label {
      border-color: #ffc107;
      background-color: rgba(255, 193, 7, 0.1);
    }
    
    .priority-option.high input[type="radio"]:checked + label {
      border-color: #fd7e14;
      background-color: rgba(253, 126, 20, 0.1);
    }
    
    .priority-option.critical input[type="radio"]:checked + label {
      border-color: #dc3545;
      background-color: rgba(220, 53, 69, 0.1);
    }
    
    .screenshot-upload {
      border: 2px dashed #ddd;
      border-radius: 8px;
      padding: 2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .screenshot-upload:hover {
      border-color: #3498db;
      background-color: rgba(52, 152, 219, 0.05);
    }
    
    .screenshot-upload.has-files {
      border-color: #28a745;
      background-color: rgba(40, 167, 69, 0.05);
    }
    
    .screenshot-upload input[type="file"] {
      display: none;
    }
    
    .upload-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }
    
    .upload-text {
      color: #7f8c8d;
    }
    
    .upload-hint {
      font-size: 0.875rem;
      color: #95a5a6;
      margin-top: 0.5rem;
    }
    
    .preview-container {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      margin-top: 1rem;
    }
    
    .preview-item {
      position: relative;
      width: 100px;
      height: 100px;
      border-radius: 4px;
      overflow: hidden;
      border: 1px solid #ddd;
    }
    
    .preview-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .preview-item .remove-btn {
      position: absolute;
      top: 0;
      right: 0;
      background-color: rgba(231, 76, 60, 0.8);
      color: #fff;
      border: none;
      width: 24px;
      height: 24px;
      cursor: pointer;
      font-size: 1rem;
      line-height: 1;
    }
    
    .form-actions {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
      margin-top: 2rem;
      padding-top: 1.5rem;
      border-top: 1px solid #eee;
    }
    
    .btn {
      padding: 0.75rem 2rem;
      border: none;
      border-radius: 4px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .btn-primary {
      background-color: #3498db;
      color: #fff;
    }
    
    .btn-primary:hover {
      background-color: #2980b9;
    }
    
    .btn-primary:disabled {
      background-color: #95a5a6;
      cursor: not-allowed;
    }
    
    .btn-secondary {
      background-color: #95a5a6;
      color: #fff;
    }
    
    .btn-secondary:hover {
      background-color: #7f8c8d;
    }
    
    /* æ¶ˆæ¯æç¤º */
    .message-container {
      position: fixed;
      top: 80px;
      right: 20px;
      z-index: 9999;
    }
    
    .message {
      padding: 1rem 1.5rem;
      border-radius: 4px;
      margin-bottom: 0.5rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      animation: slideIn 0.3s ease;
      max-width: 400px;
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    .message.success {
      background-color: #d4edda;
      color: #155724;
      border-left: 4px solid #28a745;
    }
    
    .message.error {
      background-color: #f8d7da;
      color: #721c24;
      border-left: 4px solid #dc3545;
    }
    
    .message.info {
      background-color: #d1ecf1;
      color: #0c5460;
      border-left: 4px solid #17a2b8;
    }
    
    /* é”™è¯¯æç¤º */
    .error-message {
      color: #e74c3c;
      font-size: 0.875rem;
      margin-top: 0.25rem;
    }
  </style>
</head>
<body>
  <!-- å¯¼èˆªæ  -->
  <nav class="navbar">
    <div class="navbar-container">
      <!-- å“ç‰Œæ ‡è¯† -->
      <a href="index.html" class="navbar-brand">
        <span class="navbar-brand-icon">ğŸš—</span>
        <span>äº¤é€šå›¾åº“</span>
      </a>
      
      <!-- ä¸»å¯¼èˆª -->
      <ul class="navbar-nav">
        <li class="nav-item">
          <a href="index.html" class="nav-link">é¦–é¡µ</a>
        </li>
        <li class="nav-item dropdown">
          <a href="#" class="nav-link">åˆ†ç±»</a>
          <div class="dropdown-menu" id="nav-category-dropdown"></div>
        </li>
        <li class="nav-item">
          <a href="gallery.html" class="nav-link">å‘ç°</a>
        </li>
        <li class="nav-item">
          <a href="upload.html" class="nav-link">ä¸Šä¼ </a>
        </li>
        <li class="nav-item" id="login-register-link">
          <a href="login.html" class="nav-link">ç™»å½•/æ³¨å†Œ</a>
        </li>
        <li class="nav-item dropdown user-dropdown" id="user-dropdown" style="display: none;">
          <div class="user-avatar" id="user-avatar">
            <span id="username-display"></span>
          </div>
          <div class="dropdown-menu">
            <a href="profile.html" class="dropdown-item">ä¸ªäººä¿¡æ¯</a>
            <a href="my.html" class="dropdown-item">æˆ‘çš„ä½œå“</a>
            <a href="admin.html" class="dropdown-item">ç®¡ç†åå°</a>
            <a href="review.html" class="dropdown-item">ä½œå“å®¡æ ¸</a>
            <a href="#" class="dropdown-item" onclick="logout()">é€€å‡ºç™»å½•</a>
          </div>
        </li>
      </ul>
      
      <!-- æœç´¢æ¡† -->
      <div class="search-container">
        <input type="text" id="global-search-input" class="search-input" placeholder="æœç´¢ä½œå“ã€æ‘„å½±å¸ˆ...">
        <button type="button" id="global-search-btn" class="search-btn">æœç´¢</button>
      </div>
    </div>
  </nav>

  <!-- æ¶ˆæ¯å®¹å™¨ -->
  <div id="message-container" class="message-container"></div>

  <!-- é¡µé¢å†…å®¹ -->
  <main class="content">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <section class="page-header">
      <div class="container">
        <h1 class="page-title">æäº¤BUG</h1>
        <p class="page-subtitle">å¦‚æœæ‚¨å‘ç°äº†ç½‘ç«™çš„ä»»ä½•é—®é¢˜ï¼Œè¯·åœ¨æ­¤æäº¤ï¼Œæˆ‘ä»¬ä¼šå°½å¿«å¤„ç†</p>
      </div>
    </section>

    <!-- BUGæäº¤è¡¨å• -->
    <section class="bug-section">
      <div class="container">
        <div class="bug-form-container">
          <form id="bug-form">
            <!-- BUGæ ‡é¢˜ -->
            <div class="form-group">
              <label for="bug-title" class="form-label">
                BUGæ ‡é¢˜
                <span class="required">*</span>
              </label>
              <input type="text" id="bug-title" class="form-control" placeholder="è¯·ç®€è¦æè¿°BUGï¼Œå¦‚ï¼šé¦–é¡µè½®æ’­å›¾åŠ è½½ç¼“æ…¢" maxlength="100">
              <div class="char-count"><span id="title-count">0</span>/100</div>
              <p class="form-hint">æ ‡é¢˜åº”ç®€æ´æ˜äº†ï¼Œèƒ½æ¦‚æ‹¬é—®é¢˜æ ¸å¿ƒ</p>
              <div class="error-message" id="title-error"></div>
            </div>

            <!-- BUGåˆ†ç±» -->
            <div class="form-group">
              <label for="bug-category" class="form-label">
                BUGåˆ†ç±»
                <span class="required">*</span>
              </label>
              <select id="bug-category" class="form-control">
                <option value="">è¯·é€‰æ‹©BUGåˆ†ç±»</option>
                <option value="frontend">ğŸ¨ å‰ç«¯æ˜¾ç¤ºé—®é¢˜ - é¡µé¢æ˜¾ç¤ºå¼‚å¸¸ã€æ ·å¼é”™ä¹±ç­‰</option>
                <option value="function">âš™ï¸ åŠŸèƒ½å¼‚å¸¸ - åŠŸèƒ½æ— æ³•ä½¿ç”¨æˆ–è¡Œä¸ºå¼‚å¸¸</option>
                <option value="performance">âš¡ æ€§èƒ½é—®é¢˜ - åŠ è½½ç¼“æ…¢ã€å¡é¡¿ç­‰</option>
                <option value="security">ğŸ”’ å®‰å…¨é—®é¢˜ - å®‰å…¨æ¼æ´ã€éšç§æ³„éœ²ç­‰</option>
                <option value="ui">ğŸ–¼ï¸ ç•Œé¢è®¾è®¡ - UI/UXè®¾è®¡é—®é¢˜</option>
                <option value="data">ğŸ“Š æ•°æ®é—®é¢˜ - æ•°æ®æ˜¾ç¤ºé”™è¯¯ã€ä¸¢å¤±ç­‰</option>
                <option value="other">ğŸ“Œ å…¶ä»–é—®é¢˜ - ä¸å±äºä»¥ä¸Šåˆ†ç±»çš„é—®é¢˜</option>
              </select>
              <p class="form-hint">è¯·é€‰æ‹©æœ€ç¬¦åˆé—®é¢˜ç±»å‹çš„åˆ†ç±»ï¼Œæœ‰åŠ©äºæˆ‘ä»¬å¿«é€Ÿå®šä½</p>
              <div class="error-message" id="category-error"></div>
            </div>

            <!-- BUGä¼˜å…ˆçº§ -->
            <div class="form-group">
              <label class="form-label">
                BUGä¼˜å…ˆçº§
                <span class="required">*</span>
              </label>
              <div class="priority-options">
                <div class="priority-option low">
                  <input type="radio" id="priority-low" name="priority" value="low">
                  <label for="priority-low">
                    <div>ğŸŸ¢ ä½</div>
                    <small>è½»å¾®é—®é¢˜</small>
                  </label>
                </div>
                <div class="priority-option medium">
                  <input type="radio" id="priority-medium" name="priority" value="medium" checked>
                  <label for="priority-medium">
                    <div>ğŸŸ¡ ä¸­</div>
                    <small>ä¸€èˆ¬é—®é¢˜</small>
                  </label>
                </div>
                <div class="priority-option high">
                  <input type="radio" id="priority-high" name="priority" value="high">
                  <label for="priority-high">
                    <div>ğŸŸ  é«˜</div>
                    <small>ä¸¥é‡å½±å“</small>
                  </label>
                </div>
                <div class="priority-option critical">
                  <input type="radio" id="priority-critical" name="priority" value="critical">
                  <label for="priority-critical">
                    <div>ğŸ”´ ç´§æ€¥</div>
                    <small>ç³»ç»Ÿå´©æºƒ</small>
                  </label>
                </div>
              </div>
              <p class="form-hint">è¯·æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©ä¼˜å…ˆçº§ï¼Œç´§æ€¥é—®é¢˜æˆ‘ä»¬ä¼šä¼˜å…ˆå¤„ç†</p>
            </div>

            <!-- BUGæè¿° -->
            <div class="form-group">
              <label for="bug-description" class="form-label">
                BUGæè¿°
                <span class="required">*</span>
              </label>
              <textarea id="bug-description" class="form-control" rows="6" placeholder="è¯·è¯¦ç»†æè¿°BUGçš„ç°è±¡ã€å¤ç°æ­¥éª¤å’Œé¢„æœŸç»“æœ...

ä¾‹å¦‚ï¼š
1. ç°è±¡ï¼šç‚¹å‡»ä¸Šä¼ æŒ‰é’®åé¡µé¢æ— å“åº”
2. å¤ç°æ­¥éª¤ï¼šè¿›å…¥ä¸Šä¼ é¡µé¢ â†’ é€‰æ‹©å›¾ç‰‡ â†’ ç‚¹å‡»ä¸Šä¼ æŒ‰é’®
3. é¢„æœŸç»“æœï¼šæ­£å¸¸ä¸Šä¼ å¹¶æ˜¾ç¤ºè¿›åº¦
4. å®é™…ç»“æœï¼šé¡µé¢å¡ä½ï¼Œæ§åˆ¶å°æŠ¥é”™" maxlength="2000"></textarea>
              <div class="char-count"><span id="desc-count">0</span>/2000</div>
              <p class="form-hint">è¯¦ç»†æè¿°æœ‰åŠ©äºæˆ‘ä»¬å¿«é€Ÿå®šä½å’Œä¿®å¤é—®é¢˜ï¼ˆæœ€å°‘20å­—ï¼‰</p>
              <div class="error-message" id="desc-error"></div>
            </div>

            <!-- æˆªå›¾ä¸Šä¼  -->
            <div class="form-group">
              <label class="form-label">é—®é¢˜æˆªå›¾</label>
              <div class="screenshot-upload" id="screenshot-upload">
                <input type="file" id="bug-screenshots" accept="image/*" multiple>
                <div class="upload-icon">ğŸ“·</div>
                <div class="upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ æˆªå›¾</div>
                <div class="upload-hint">æ”¯æŒ JPGã€PNG æ ¼å¼ï¼Œæœ€å¤š5å¼ ï¼Œå•å¼ ä¸è¶…è¿‡5MB</div>
              </div>
              <div class="preview-container" id="preview-container"></div>
              <p class="form-hint">æˆªå›¾èƒ½å¸®åŠ©æˆ‘ä»¬æ›´ç›´è§‚åœ°äº†è§£é—®é¢˜</p>
            </div>

            <!-- æµè§ˆå™¨ä¿¡æ¯ -->
            <div class="form-group">
              <label for="bug-browser" class="form-label">æµè§ˆå™¨åŠç³»ç»Ÿä¿¡æ¯</label>
              <input type="text" id="bug-browser" class="form-control" placeholder="è‡ªåŠ¨æ£€æµ‹ä¸­...">
              <p class="form-hint">æˆ‘ä»¬ä¼šè‡ªåŠ¨è·å–æ‚¨çš„æµè§ˆå™¨ä¿¡æ¯ï¼Œå¦‚æœ‰è¯¯è¯·æ‰‹åŠ¨ä¿®æ”¹</p>
            </div>

            <!-- è”ç³»æ–¹å¼ -->
            <div class="form-group">
              <label for="bug-contact" class="form-label">
                è”ç³»æ–¹å¼
                <span class="required">*</span>
              </label>
              <input type="text" id="bug-contact" class="form-control" placeholder="è¯·è¾“å…¥æ‚¨çš„é‚®ç®±æˆ–æ‰‹æœºå·ï¼Œæ–¹ä¾¿æˆ‘ä»¬å›å¤">
              <p class="form-hint">æ‚¨çš„è”ç³»æ–¹å¼ä»…ç”¨äºå›å¤BUGå¤„ç†ç»“æœï¼Œä¸ä¼šå…¬å¼€</p>
              <div class="error-message" id="contact-error"></div>
            </div>

            <!-- æäº¤æŒ‰é’® -->
            <div class="form-actions">
              <button type="button" class="btn btn-secondary" onclick="resetForm()">é‡ç½®</button>
              <button type="submit" class="btn btn-primary" id="submit-btn">æäº¤BUG</button>
            </div>
          </form>
        </div>
      </div>
    </section>
  </main>

  <!-- é¡µè„š -->
  <footer class="footer">
    <div class="footer-container">
      <div class="footer-row">
        <div class="footer-col">
          <h3>å…³äºæˆ‘ä»¬</h3>
          <ul class="footer-links">
            <li><a href="about.html">å…³äºäº¤é€šå›¾åº“</a></li>
            <li><a href="about.html#rules">ä½¿ç”¨è§„åˆ™</a></li>
            <li><a href="about.html#contact">è”ç³»æˆ‘ä»¬</a></li>
          </ul>
        </div>
        <div class="footer-col">
          <h3>å¿«é€Ÿé“¾æ¥</h3>
          <ul class="footer-links">
            <li><a href="gallery.html">æœ€æ–°ä½œå“</a></li>
            <li><a href="gallery.html?sort=popular">çƒ­é—¨ä½œå“</a></li>
            <li><a href="upload.html">ä¸Šä¼ ä½œå“</a></li>
          </ul>
        </div>
        <div class="footer-col">
          <h3>å¸®åŠ©ä¸­å¿ƒ</h3>
          <ul class="footer-links">
            <li><a href="faq.html">å¸¸è§é—®é¢˜</a></li>
            <li><a href="bug.html">æäº¤BUG</a></li>
            <li><a href="bug-list.html">BUGåˆ—è¡¨</a></li>
          </ul>
        </div>
      </div>
      
      <!-- ç»Ÿè®¡ä¿¡æ¯ -->
      <div class="footer-stats">
        <div class="footer-stats-item">
          <span class="footer-stats-number" id="online-users">0</span>
          <span class="footer-stats-label">åœ¨çº¿äººæ•°</span>
        </div>
        <div class="footer-stats-item">
          <span class="footer-stats-number" id="total-visits">0</span>
          <span class="footer-stats-label">ç´¯è®¡è®¿é—®</span>
        </div>
        <div class="footer-stats-item">
          <span class="footer-stats-number" id="registered-users">0</span>
          <span class="footer-stats-label">æ³¨å†Œç”¨æˆ·</span>
        </div>
        <div class="footer-stats-item">
          <span class="footer-stats-number" id="today-visits">0</span>
          <span class="footer-stats-label">ä»Šæ—¥è®¿é—®</span>
        </div>
      </div>
      
      <!-- ç‰ˆæƒä¿¡æ¯ -->
      <div class="footer-bottom">
        <p>&copy; 2026 äº¤é€šå›¾åº“ - å…¨å“ç±»äº¤é€šæ‘„å½±ä½œå“åˆ†äº«å¹³å° | ç‰ˆæœ¬ v1.0.0</p>
      </div>
    </div>
  </footer>

  <!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
  <div class="back-to-top" id="back-to-top">â†‘</div>

  <!-- BUGæäº¤è„šæœ¬ -->
  <script>
    // æˆªå›¾æ–‡ä»¶æ•°ç»„
    let screenshotFiles = [];

    // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
    document.addEventListener('DOMContentLoaded', function() {
      // è‡ªåŠ¨å¡«å……æµè§ˆå™¨ä¿¡æ¯
      fillBrowserInfo();
      
      // ç»‘å®šè¡¨å•äº‹ä»¶
      bindFormEvents();
      
      // ç»‘å®šæˆªå›¾ä¸Šä¼ äº‹ä»¶
      bindScreenshotUpload();
    });

    // å¡«å……æµè§ˆå™¨ä¿¡æ¯
    function fillBrowserInfo() {
      const browserInfo = navigator.userAgent;
      const browserInput = document.getElementById('bug-browser');
      browserInput.value = browserInfo;
    }

    // ç»‘å®šè¡¨å•äº‹ä»¶
    function bindFormEvents() {
      const form = document.getElementById('bug-form');
      const titleInput = document.getElementById('bug-title');
      const descInput = document.getElementById('bug-description');
      const contactInput = document.getElementById('bug-contact');

      // æ ‡é¢˜å­—ç¬¦è®¡æ•°
      titleInput.addEventListener('input', function() {
        const count = this.value.length;
        const countEl = document.getElementById('title-count');
        countEl.textContent = count;
        
        if (count > 90) {
          countEl.parentElement.classList.add('warning');
        } else {
          countEl.parentElement.classList.remove('warning');
        }
        
        // æ¸…é™¤é”™è¯¯çŠ¶æ€
        this.classList.remove('error');
        document.getElementById('title-error').textContent = '';
      });

      // æè¿°å­—ç¬¦è®¡æ•°
      descInput.addEventListener('input', function() {
        const count = this.value.length;
        const countEl = document.getElementById('desc-count');
        countEl.textContent = count;
        
        if (count > 1800) {
          countEl.parentElement.classList.add('warning');
        } else {
          countEl.parentElement.classList.remove('warning');
        }
        
        // æ¸…é™¤é”™è¯¯çŠ¶æ€
        this.classList.remove('error');
        document.getElementById('desc-error').textContent = '';
      });

      // è”ç³»æ–¹å¼éªŒè¯
      contactInput.addEventListener('input', function() {
        this.classList.remove('error');
        document.getElementById('contact-error').textContent = '';
      });

      // åˆ†ç±»é€‰æ‹©
      document.getElementById('bug-category').addEventListener('change', function() {
        this.classList.remove('error');
        document.getElementById('category-error').textContent = '';
      });

      // è¡¨å•æäº¤
      form.addEventListener('submit', handleSubmit);
    }

    // ç»‘å®šæˆªå›¾ä¸Šä¼ äº‹ä»¶
    function bindScreenshotUpload() {
      const uploadArea = document.getElementById('screenshot-upload');
      const fileInput = document.getElementById('bug-screenshots');

      // ç‚¹å‡»ä¸Šä¼ 
      uploadArea.addEventListener('click', function() {
        fileInput.click();
      });

      // æ‹–æ‹½ä¸Šä¼ 
      uploadArea.addEventListener('dragover', function(e) {
        e.preventDefault();
        this.style.borderColor = '#3498db';
      });

      uploadArea.addEventListener('dragleave', function(e) {
        e.preventDefault();
        this.style.borderColor = '#ddd';
      });

      uploadArea.addEventListener('drop', function(e) {
        e.preventDefault();
        this.style.borderColor = '#ddd';
        handleFiles(e.dataTransfer.files);
      });

      // æ–‡ä»¶é€‰æ‹©
      fileInput.addEventListener('change', function() {
        handleFiles(this.files);
      });
    }

    // å¤„ç†æ–‡ä»¶
    function handleFiles(files) {
      const maxFiles = 5;
      const maxSize = 5 * 1024 * 1024; // 5MB

      Array.from(files).forEach(file => {
        // æ£€æŸ¥æ•°é‡é™åˆ¶
        if (screenshotFiles.length >= maxFiles) {
          showMessage('æœ€å¤šåªèƒ½ä¸Šä¼ 5å¼ æˆªå›¾', 'error');
          return;
        }

        // æ£€æŸ¥æ–‡ä»¶ç±»å‹
        if (!file.type.startsWith('image/')) {
          showMessage(`${file.name} ä¸æ˜¯å›¾ç‰‡æ–‡ä»¶`, 'error');
          return;
        }

        // æ£€æŸ¥æ–‡ä»¶å¤§å°
        if (file.size > maxSize) {
          showMessage(`${file.name} è¶…è¿‡5MBé™åˆ¶`, 'error');
          return;
        }

        // è¯»å–æ–‡ä»¶
        const reader = new FileReader();
        reader.onload = function(e) {
          screenshotFiles.push({
            name: file.name,
            data: e.target.result,
            size: file.size
          });
          updatePreview();
        };
        reader.readAsDataURL(file);
      });
    }

    // æ›´æ–°é¢„è§ˆ
    function updatePreview() {
      const container = document.getElementById('preview-container');
      const uploadArea = document.getElementById('screenshot-upload');

      container.innerHTML = '';

      screenshotFiles.forEach((file, index) => {
        const item = document.createElement('div');
        item.className = 'preview-item';
        item.innerHTML = `
          <img src="${file.data}" alt="${file.name}">
          <button type="button" class="remove-btn" onclick="removeScreenshot(${index})">Ã—</button>
        `;
        container.appendChild(item);
      });

      // æ›´æ–°ä¸Šä¼ åŒºåŸŸæ ·å¼
      if (screenshotFiles.length > 0) {
        uploadArea.classList.add('has-files');
        uploadArea.querySelector('.upload-text').textContent = `å·²é€‰æ‹© ${screenshotFiles.length} å¼ æˆªå›¾`;
      } else {
        uploadArea.classList.remove('has-files');
        uploadArea.querySelector('.upload-text').textContent = 'ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ æˆªå›¾';
      }
    }

    // åˆ é™¤æˆªå›¾
    function removeScreenshot(index) {
      screenshotFiles.splice(index, 1);
      updatePreview();
    }

    // å¤„ç†è¡¨å•æäº¤
    function handleSubmit(e) {
      e.preventDefault();

      // æ¸…é™¤ä¹‹å‰çš„é”™è¯¯
      clearErrors();

      // è·å–è¡¨å•æ•°æ®
      const formData = {
        title: document.getElementById('bug-title').value.trim(),
        category: document.getElementById('bug-category').value,
        priority: document.querySelector('input[name="priority"]:checked').value,
        description: document.getElementById('bug-description').value.trim(),
        browser: document.getElementById('bug-browser').value.trim(),
        contact: document.getElementById('bug-contact').value.trim(),
        screenshots: screenshotFiles
      };

      // éªŒè¯å¿…å¡«é¡¹
      let hasError = false;

      if (!formData.title) {
        showFieldError('bug-title', 'title-error', 'è¯·è¾“å…¥BUGæ ‡é¢˜');
        hasError = true;
      }

      if (!formData.category) {
        showFieldError('bug-category', 'category-error', 'è¯·é€‰æ‹©BUGåˆ†ç±»');
        hasError = true;
      }

      if (!formData.description) {
        showFieldError('bug-description', 'desc-error', 'è¯·è¾“å…¥BUGæè¿°');
        hasError = true;
      }

      if (!formData.contact) {
        showFieldError('bug-contact', 'contact-error', 'è¯·è¾“å…¥è”ç³»æ–¹å¼');
        hasError = true;
      }

      if (hasError) {
        showMessage('è¯·å®Œå–„å¿…å¡«é¡¹', 'error');
        return;
      }

      // æäº¤æŒ‰é’®ç¦ç”¨
      const submitBtn = document.getElementById('submit-btn');
      submitBtn.disabled = true;
      submitBtn.textContent = 'æäº¤ä¸­...';

      // è°ƒç”¨åŒæ­¥æäº¤å‡½æ•°
      try {
        // ä½¿ç”¨ bug-sync.js çš„åŒæ­¥æäº¤åŠŸèƒ½
        const result = syncBugSubmit(formData);

        if (result.success) {
          showMessage('BUGæäº¤æˆåŠŸï¼æˆ‘ä»¬ä¼šå°½å¿«å¤„ç†æ‚¨çš„åé¦ˆ', 'success');
          
          // å»¶è¿Ÿé‡ç½®è¡¨å•
          setTimeout(() => {
            resetForm();
            // è·³è½¬åˆ°BUGåˆ—è¡¨
            window.location.href = 'bug-list.html';
          }, 2000);
        } else {
          showMessage(result.message || 'æäº¤å¤±è´¥', 'error');
          submitBtn.disabled = false;
          submitBtn.textContent = 'æäº¤BUG';
        }
      } catch (error) {
        console.error('æäº¤BUGå¤±è´¥:', error);
        showMessage('æäº¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
        submitBtn.disabled = false;
        submitBtn.textContent = 'æäº¤BUG';
      }
    }

    // æ˜¾ç¤ºå­—æ®µé”™è¯¯
    function showFieldError(fieldId, errorId, message) {
      document.getElementById(fieldId).classList.add('error');
      document.getElementById(errorId).textContent = message;
    }

    // æ¸…é™¤é”™è¯¯
    function clearErrors() {
      document.querySelectorAll('.form-control').forEach(el => el.classList.remove('error'));
      document.querySelectorAll('.error-message').forEach(el => el.textContent = '');
    }

    // é‡ç½®è¡¨å•
    function resetForm() {
      document.getElementById('bug-form').reset();
      screenshotFiles = [];
      updatePreview();
      document.getElementById('title-count').textContent = '0';
      document.getElementById('desc-count').textContent = '0';
      clearErrors();
      fillBrowserInfo();
      
      const submitBtn = document.getElementById('submit-btn');
      submitBtn.disabled = false;
      submitBtn.textContent = 'æäº¤BUG';
    }

    // æ˜¾ç¤ºæ¶ˆæ¯
    function showMessage(message, type = 'info') {
      const container = document.getElementById('message-container');
      const msgEl = document.createElement('div');
      msgEl.className = `message ${type}`;
      msgEl.textContent = message;
      container.appendChild(msgEl);

      // 3ç§’åè‡ªåŠ¨ç§»é™¤
      setTimeout(() => {
        msgEl.style.opacity = '0';
        msgEl.style.transform = 'translateX(100%)';
        setTimeout(() => msgEl.remove(), 300);
      }, 3000);
    }
  </script>
</body>
</html>
