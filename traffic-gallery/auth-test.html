<!DOCTYPE html>
<!--
================================================================================
äº¤é€šå›¾åº“ - ç”¨æˆ·è®¤è¯æµ‹è¯•é¡µé¢ (auth-test.html)
================================================================================

ã€æ–‡ä»¶è¯´æ˜ã€‘
æœ¬æ–‡ä»¶æ˜¯äº¤é€šå›¾åº“ç½‘ç«™çš„ç”¨æˆ·è®¤è¯æµ‹è¯•é¡µé¢ï¼Œç”¨äºéªŒè¯æ–°çš„å¯†é’¥ç»‘å®šéªŒè¯æœºåˆ¶ã€‚

ã€æµ‹è¯•å†…å®¹ã€‘
1. ç®¡ç†å‘˜è´¦å·ç™»å½•æµ‹è¯•
2. æ–°ç”¨æˆ·æ³¨å†Œæµ‹è¯•
3. å¯†é’¥éªŒè¯æµ‹è¯•
4. ç™»å½•å¤±è´¥é”å®šæµ‹è¯•
5. å¯†é’¥é‡ç½®åŠŸèƒ½æµ‹è¯•

ã€æŠ€æœ¯ç‰¹ç‚¹ã€‘
- ç‹¬ç«‹çš„æµ‹è¯•é¡µé¢ï¼Œä¸å½±å“ä¸»ç³»ç»Ÿ
- æä¾›å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹
- å®æ—¶æ˜¾ç¤ºæµ‹è¯•ç»“æœ
- æ”¯æŒä¸€é”®é‡ç½®æµ‹è¯•æ•°æ®

ã€ä¾èµ–æ–‡ä»¶ã€‘
- JSæ–‡ä»¶ï¼šjs/config.js, js/data.js, js/auth.js

ã€ä½œè€…ã€‘AI Assistant
ã€æ—¥æœŸã€‘2026-02-21
ã€ç‰ˆæœ¬ã€‘v1.0.0
================================================================================
-->
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”¨æˆ·è®¤è¯æµ‹è¯• - äº¤é€šå›¾åº“</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: #4CAF50;
            color: white;
            padding: 30px 20px;
            text-align: center;
            margin-bottom: 30px;
            border-radius: 8px;
        }
        
        h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .test-section {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        h2 {
            color: #4CAF50;
            margin-bottom: 15px;
            font-size: 1.3rem;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input[type="text"],
        input[type="password"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .btn {
            display: inline-block;
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s ease;
        }
        
        .btn-primary {
            background-color: #4CAF50;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #45a049;
        }
        
        .btn-secondary {
            background-color: #f0f0f0;
            color: #333;
        }
        
        .btn-secondary:hover {
            background-color: #e0e0e0;
        }
        
        .btn-danger {
            background-color: #f44336;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #d32f2f;
        }
        
        .result-box {
            margin-top: 15px;
            padding: 15px;
            border-radius: 4px;
            display: none;
        }
        
        .result-success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .result-error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .result-info {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        
        .info-box {
            background-color: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        .info-box h3 {
            color: #1976D2;
            margin-bottom: 10px;
        }
        
        .test-case {
            background-color: #f9f9f9;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #4CAF50;
        }
        
        .test-case h4 {
            color: #333;
            margin-bottom: 8px;
        }
        
        .test-case p {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        
        .key-display {
            background-color: #fff;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 1.1rem;
            text-align: center;
            letter-spacing: 2px;
            margin: 10px 0;
            border: 2px dashed #4CAF50;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #f5f5f5;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <header>
        <h1>ğŸ” ç”¨æˆ·è®¤è¯æµ‹è¯•</h1>
        <p>æµ‹è¯•æ–°çš„ç”¨æˆ·ç»‘å®šå¯†é’¥éªŒè¯æœºåˆ¶</p>
    </header>
    
    <div class="container">
        <div class="info-box">
            <h3>ğŸ“‹ æµ‹è¯•è¯´æ˜</h3>
            <p>æœ¬é¡µé¢ç”¨äºæµ‹è¯•æ–°çš„è®¤è¯ç³»ç»Ÿï¼ŒåŒ…å«ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>ç”¨æˆ·å + å¯†ç  + ç»‘å®šå¯†é’¥ ä¸‰é‡éªŒè¯</li>
                <li>æ³¨å†Œæ—¶è‡ªåŠ¨ç”Ÿæˆç»‘å®šå¯†é’¥</li>
                <li>ç™»å½•å¤±è´¥5æ¬¡åé”å®š30åˆ†é’Ÿ</li>
                <li>ç®¡ç†å‘˜é¢„è®¾è´¦å·ï¼šadmin / admin123</li>
            </ul>
        </div>

        <!-- ç®¡ç†å‘˜ç™»å½•æµ‹è¯• -->
        <div class="test-section">
            <h2>1. ç®¡ç†å‘˜ç™»å½•æµ‹è¯•</h2>
            <div class="test-case">
                <h4>æµ‹è¯•ç”¨ä¾‹ï¼šç®¡ç†å‘˜è´¦å·</h4>
                <p>ç”¨æˆ·åï¼šadmin</p>
                <p>å¯†ç ï¼šadmin123</p>
                <p>å¯†é’¥ï¼šADMIN_SECRET_KEY_2026_TRAFFIC_GALLERY</p>
            </div>
            <div class="form-group">
                <label>ç”¨æˆ·å</label>
                <input type="text" id="admin-username" value="admin" readonly>
            </div>
            <div class="form-group">
                <label>å¯†ç </label>
                <input type="password" id="admin-password" placeholder="è¯·è¾“å…¥å¯†ç ">
            </div>
            <div class="form-group">
                <label>ç»‘å®šå¯†é’¥</label>
                <input type="text" id="admin-secret-key" placeholder="è¯·è¾“å…¥ç»‘å®šå¯†é’¥">
            </div>
            <button class="btn btn-primary" onclick="testAdminLogin()">æµ‹è¯•ç®¡ç†å‘˜ç™»å½•</button>
            <div id="admin-result" class="result-box"></div>
        </div>

        <!-- æ–°ç”¨æˆ·æ³¨å†Œæµ‹è¯• -->
        <div class="test-section">
            <h2>2. æ–°ç”¨æˆ·æ³¨å†Œæµ‹è¯•</h2>
            <div class="form-group">
                <label>ç”¨æˆ·å</label>
                <input type="text" id="reg-username" placeholder="è¯·è¾“å…¥ç”¨æˆ·åï¼ˆ3-20ä¸ªå­—ç¬¦ï¼‰">
            </div>
            <div class="form-group">
                <label>å¯†ç </label>
                <input type="password" id="reg-password" placeholder="è¯·è¾“å…¥å¯†ç ï¼ˆ6-20ä¸ªå­—ç¬¦ï¼‰">
            </div>
            <div class="form-group">
                <label>ç¡®è®¤å¯†ç </label>
                <input type="password" id="reg-confirm-password" placeholder="è¯·ç¡®è®¤å¯†ç ">
            </div>
            <button class="btn btn-primary" onclick="testRegister()">æµ‹è¯•æ³¨å†Œ</button>
            <div id="reg-result" class="result-box"></div>
            <div id="reg-secret-key" class="key-display" style="display: none;"></div>
        </div>

        <!-- æ™®é€šç”¨æˆ·ç™»å½•æµ‹è¯• -->
        <div class="test-section">
            <h2>3. æ™®é€šç”¨æˆ·ç™»å½•æµ‹è¯•</h2>
            <div class="form-group">
                <label>ç”¨æˆ·å</label>
                <input type="text" id="user-username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
            </div>
            <div class="form-group">
                <label>å¯†ç </label>
                <input type="password" id="user-password" placeholder="è¯·è¾“å…¥å¯†ç ">
            </div>
            <div class="form-group">
                <label>ç»‘å®šå¯†é’¥</label>
                <input type="text" id="user-secret-key" placeholder="è¯·è¾“å…¥ç»‘å®šå¯†é’¥">
            </div>
            <button class="btn btn-primary" onclick="testUserLogin()">æµ‹è¯•ç”¨æˆ·ç™»å½•</button>
            <div id="user-result" class="result-box"></div>
        </div>

        <!-- æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨ -->
        <div class="test-section">
            <h2>4. æŸ¥çœ‹å·²æ³¨å†Œç”¨æˆ·</h2>
            <button class="btn btn-secondary" onclick="showUserList()">åˆ·æ–°ç”¨æˆ·åˆ—è¡¨</button>
            <button class="btn btn-danger" onclick="clearAllData()">æ¸…ç©ºæ‰€æœ‰æµ‹è¯•æ•°æ®</button>
            <div id="user-list-container" style="margin-top: 15px;">
                <table id="user-table" style="display: none;">
                    <thead>
                        <tr>
                            <th>ç”¨æˆ·å</th>
                            <th>æ˜¯å¦ç®¡ç†å‘˜</th>
                            <th>åˆ›å»ºæ—¶é—´</th>
                            <th>æœ€åç™»å½•</th>
                            <th>ç™»å½•å¤±è´¥æ¬¡æ•°</th>
                        </tr>
                    </thead>
                    <tbody id="user-table-body"></tbody>
                </table>
                <p id="no-users-msg" style="text-align: center; color: #666; margin-top: 20px;">æš‚æ— æ³¨å†Œç”¨æˆ·</p>
            </div>
        </div>

        <!-- å½“å‰ç™»å½•çŠ¶æ€ -->
        <div class="test-section">
            <h2>5. å½“å‰ç™»å½•çŠ¶æ€</h2>
            <div id="login-status" class="result-info" style="display: block;">
                <p>å½“å‰çŠ¶æ€ï¼šæœªç™»å½•</p>
            </div>
            <button class="btn btn-secondary" onclick="checkLoginStatus()">åˆ·æ–°çŠ¶æ€</button>
            <button class="btn btn-danger" onclick="logout()" style="display: none;" id="logout-btn">é€€å‡ºç™»å½•</button>
        </div>
    </div>

    <!-- å¼•å…¥æ ¸å¿ƒè„šæœ¬ -->
    <script src="js/config.js"></script>
    <script src="js/database.js"></script>
    <script src="js/auth.js"></script>
    
    <script>
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
            showUserList();
        });

        // æ˜¾ç¤ºç»“æœ
        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = 'result-box result-' + type;
            element.style.display = 'block';
        }

        // æµ‹è¯•ç®¡ç†å‘˜ç™»å½•
        function testAdminLogin() {
            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            const secretKey = document.getElementById('admin-secret-key').value;

            if (!password || !secretKey) {
                showResult('admin-result', 'è¯·è¾“å…¥å¯†ç å’Œå¯†é’¥', 'error');
                return;
            }

            const result = userLoginWithSecretKey(username, password, secretKey);
            
            if (result.success) {
                showResult('admin-result', 'âœ… ' + result.message + 'ï¼ˆç®¡ç†å‘˜è´¦å·ï¼‰', 'success');
                checkLoginStatus();
            } else {
                showResult('admin-result', 'âŒ ' + result.message, 'error');
            }
        }

        // æµ‹è¯•æ³¨å†Œ
        function testRegister() {
            const username = document.getElementById('reg-username').value.trim();
            const password = document.getElementById('reg-password').value;
            const confirmPassword = document.getElementById('reg-confirm-password').value;

            const result = userRegisterWithSecretKey(username, password, confirmPassword);
            
            if (result.success) {
                showResult('reg-result', 'âœ… ' + result.message, 'success');
                document.getElementById('reg-secret-key').textContent = 'æ‚¨çš„å¯†é’¥ï¼š' + result.secretKey;
                document.getElementById('reg-secret-key').style.display = 'block';
                showUserList();
            } else {
                showResult('reg-result', 'âŒ ' + result.message, 'error');
                document.getElementById('reg-secret-key').style.display = 'none';
            }
        }

        // æµ‹è¯•æ™®é€šç”¨æˆ·ç™»å½•
        function testUserLogin() {
            const username = document.getElementById('user-username').value.trim();
            const password = document.getElementById('user-password').value;
            const secretKey = document.getElementById('user-secret-key').value.trim();

            if (!username || !password || !secretKey) {
                showResult('user-result', 'è¯·å¡«å†™æ‰€æœ‰å­—æ®µ', 'error');
                return;
            }

            const result = userLoginWithSecretKey(username, password, secretKey);
            
            if (result.success) {
                showResult('user-result', 'âœ… ' + result.message, 'success');
                checkLoginStatus();
                showUserList();
            } else {
                showResult('user-result', 'âŒ ' + result.message, 'error');
            }
        }

        // æ˜¾ç¤ºç”¨æˆ·åˆ—è¡¨
        function showUserList() {
            const users = getAllUsers();
            const table = document.getElementById('user-table');
            const tbody = document.getElementById('user-table-body');
            const noUsersMsg = document.getElementById('no-users-msg');

            if (users.length === 0) {
                table.style.display = 'none';
                noUsersMsg.style.display = 'block';
                return;
            }

            table.style.display = 'table';
            noUsersMsg.style.display = 'none';
            tbody.innerHTML = '';

            users.forEach(user => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${user.username}</td>
                    <td>${user.isAdmin ? 'âœ… æ˜¯' : 'âŒ å¦'}</td>
                    <td>${new Date(user.createdAt).toLocaleString()}</td>
                    <td>${user.lastLogin ? new Date(user.lastLogin).toLocaleString() : 'ä»æœªç™»å½•'}</td>
                    <td>${user.loginAttempts || 0}</td>
                `;
            });
        }

        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        function checkLoginStatus() {
            const user = getCurrentUser();
            const statusDiv = document.getElementById('login-status');
            const logoutBtn = document.getElementById('logout-btn');

            if (user && user !== 'null') {
                statusDiv.innerHTML = `
                    <p><strong>âœ… å·²ç™»å½•</strong></p>
                    <p>ç”¨æˆ·åï¼š${user.username}</p>
                    <p>æ˜¯å¦ç®¡ç†å‘˜ï¼š${user.isAdmin ? 'æ˜¯' : 'å¦'}</p>
                    <p>ç™»å½•æ—¶é—´ï¼š${new Date(user.loginTime).toLocaleString()}</p>
                `;
                logoutBtn.style.display = 'inline-block';
            } else {
                statusDiv.innerHTML = '<p>å½“å‰çŠ¶æ€ï¼šæœªç™»å½•</p>';
                logoutBtn.style.display = 'none';
            }
        }

        // é€€å‡ºç™»å½•
        function logout() {
            userLogout();
            checkLoginStatus();
            alert('å·²é€€å‡ºç™»å½•');
        }

        // æ¸…ç©ºæ‰€æœ‰æµ‹è¯•æ•°æ®
        function clearAllData() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ç”¨æˆ·æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                localStorage.removeItem(GLOBAL_CONST.STORAGE_USERS_KEY);
                localStorage.removeItem(GLOBAL_CONST.STORAGE_SECRET_KEY);
                localStorage.removeItem(GLOBAL_CONST.STORAGE_USER_KEY);
                alert('æ‰€æœ‰æ•°æ®å·²æ¸…ç©º');
                showUserList();
                checkLoginStatus();
                location.reload();
            }
        }
    </script>
</body>
</html>